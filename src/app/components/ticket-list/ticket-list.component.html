<div class="ticket-list-container">
  <div class="page-header">
    <div>
      <h1>All Tickets</h1>
      <p class="subtitle">Manage and track all support tickets</p>
    </div>
    <a routerLink="/tickets/new" class="btn btn-primary">
      <span class="btn-icon">‚ûï</span>
      Create New Ticket
    </a>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="Search tickets..."
        [value]="searchTerm()"
        (input)="onSearch($event)"
        class="search-input"
      />
      <span class="search-icon">üîç</span>
    </div>

    <div class="filter-controls">
      <select [value]="filterStatus()" (change)="onFilterStatus($event)" class="filter-select">
        <option value="all">All Status</option>
        @for (status of statusOptions; track status) {
          <option [value]="status">{{ status }}</option>
        }
      </select>

      <select [value]="filterPriority()" (change)="onFilterPriority($event)" class="filter-select">
        <option value="all">All Priority</option>
        @for (priority of priorityOptions; track priority) {
          <option [value]="priority">{{ priority }}</option>
        }
      </select>

      <select [value]="filterCategory()" (change)="onFilterCategory($event)" class="filter-select">
        <option value="all">All Categories</option>
        @for (category of categoryOptions; track category) {
          <option [value]="category">{{ category }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <p>Showing {{ filteredTickets().length }} of {{ tickets().length }} tickets</p>
  </div>

  <!-- Tickets Table -->
  @if (filteredTickets().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h3>No tickets found</h3>
      <p>Try adjusting your search or filters</p>
      <a routerLink="/tickets/new" class="btn btn-primary">Create First Ticket</a>
    </div>
  } @else {
    <div class="tickets-table-wrapper">
      <table class="tickets-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Category</th>
            <th (click)="onSort('priority')" class="sortable">
              Priority {{ getSortIcon('priority') }}
            </th>
            <th (click)="onSort('status')" class="sortable">
              Status {{ getSortIcon('status') }}
            </th>
            <th>Assigned To</th>
            <th>Reported By</th>
            <th (click)="onSort('date')" class="sortable">
              Created {{ getSortIcon('date') }}
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (ticket of filteredTickets(); track ticket.id) {
            <tr class="ticket-row" [routerLink]="['/tickets', ticket.id]">
              <td class="ticket-id">#{{ ticket.id }}</td>
              <td class="ticket-title">
                <div class="title-content">
                  <strong>{{ ticket.title }}</strong>
                  @if (ticket.comments.length > 0) {
                    <span class="comment-count">üí¨ {{ ticket.comments.length }}</span>
                  }
                </div>
              </td>
              <td>
                <span class="badge badge-category">{{ ticket.category }}</span>
              </td>
              <td>
                <span class="badge" [class]="getPriorityClass(ticket.priority)">
                  {{ ticket.priority }}
                </span>
              </td>
              <td>
                <span class="badge" [class]="getStatusClass(ticket.status)">
                  {{ ticket.status }}
                </span>
              </td>
              <td>{{ ticket.assignedTo }}</td>
              <td>{{ ticket.reportedBy }}</td>
              <td>{{ ticket.createdAt | date: 'short' }}</td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <a [routerLink]="['/tickets', ticket.id]" class="btn-action btn-view" title="View">
                    üëÅÔ∏è
                  </a>
                  <a [routerLink]="['/tickets', ticket.id, 'edit']" class="btn-action btn-edit" title="Edit" (click)="$event.stopPropagation()">
                    ‚úèÔ∏è
                  </a>
                  <button (click)="deleteTicket(ticket.id, $event)" class="btn-action btn-delete" title="Delete">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Back to Dashboard -->
  <div class="footer-actions">
    <a routerLink="/" class="btn btn-secondary">
      ‚Üê Back to Dashboard
    </a>
  </div>
</div>
